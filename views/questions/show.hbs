<article class="bg-white rounded-2xl shadow-md p-6 mb-8">
  <div class="flex items-center space-x-4 mb-4">
    <img class="w-12 h-12 rounded-full" src="{{questionAuthorProfilePicture}}" alt="Profile Picture">
    <h1 class="text-3xl font-bold">{{question.title}}</h1>
  </div>
  <p class="text-gray-700 mb-4">{{{question.content}}}</p>
  <p class="text-sm text-gray-500 mb-4">Posted on {{formatDate question.createdAt}}</p>

  {{#if isOwner}}
    <div class="flex space-x-2 mb-6">
      <form method="POST" action="/questions/{{question._id}}?_method=DELETE">
        <button class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition" type="submit">Delete Question</button>
      </form>
      <a href="/questions/{{question._id}}/edit" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition">Edit</a>
    </div>
  {{/if}}

  {{#if session.userId}}
    <section class="mb-8">
      <h2 class="text-2xl font-semibold mb-2">Write a Comment</h2>
      <form action="/comments/{{question._id}}" method="post" class="space-y-2">
        <textarea name="content" rows="4" class="w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-indigo-200" placeholder="Your comment..." required></textarea>
        <small class="text-gray-500">Supports Markdown</small>
        <button class="mt-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition" type="submit">Submit</button>
      </form>
    </section>
  {{/if}}

  <section>
    <ul class="space-y-6">
      {{#each comments}}
        <li class="bg-gray-50 rounded-2xl p-5 shadow-sm" id="comment-{{this._id}}">
          <div class="flex items-center justify-between mb-3">
            <div class="flex items-center space-x-3">
              <img class="w-10 h-10 rounded-full" src="{{this.profilePicture}}" alt="Profile Picture">
              <div>
                <p class="font-semibold">{{this.author.username}}</p>
                <p class="text-sm text-gray-500">{{formatDate this.createdAt}}</p>
              </div>
            </div>
            {{#if this.isAccepted}}<span class="text-green-500 font-bold">✓ Accepted</span>{{/if}}
          </div>

          <p class="text-gray-700 mb-4">{{{this.content}}}</p>
          <div class="flex items-center space-x-4 text-sm">
            <span class="font-semibold text-lg" id="score-{{this._id}}">Score: {{this.score}}</span>
            {{#if ../session.userId}}
              <button class="vote-btn text-lg {{#if (eq this.userVote 1)}}voted-up{{/if}}" data-comment-id="{{this._id}}" data-user-id="{{../session.userId}}" data-vote-type="upvote">↑</button>
              <button class="vote-btn text-lg {{#if (eq this.userVote -1)}}voted-down{{/if}}" data-comment-id="{{this._id}}" data-user-id="{{../session.userId}}" data-vote-type="downvote">↓</button>
            {{/if}}
          </div>

          {{#if ../isOwner}}
            <form method="POST" action="/questions/{{../question._id}}/accept/{{this._id}}?_method=PUT" class="mt-4">
              <button class="px-4 py-2 rounded-lg {{#if this.isAccepted}}bg-green-500 text-white{{else}}bg-gray-200 text-gray-700 hover:bg-gray-300{{/if}} transition" type="submit">
                {{#if this.isAccepted}}Accepted{{else}}Accept Answer{{/if}}
              </button>
            </form>
          {{/if}}

          {{#if this.isCommentOwner}}
            <div class="mt-4 space-x-2">
              <button class="px-3 py-1 bg-red-400 text-white rounded-lg hover:bg-red-500 transition delete-btn" data-comment-id="{{this._id}}">Delete</button>
              <a href="/comments/{{this._id}}/edit" class="px-3 py-1 bg-yellow-400 text-white rounded-lg hover:bg-yellow-500 transition">Edit</a>
            </div>
          {{/if}}

          {{#if ../session.userId}}
            <div class="mt-4 pl-8">
              <form action="/subComments/{{this._id}}/{{../question._id}}" method="post" class="space-y-2">
                <textarea name="content" rows="2" class="w-full border border-gray-300 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-indigo-200" placeholder="Write a reply..." required></textarea>
                <button class="px-3 py-1 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 transition" type="submit">Reply</button>
              </form>
            </div>
          {{/if}}

          {{#each this.subComments}}
            <div class="mt-4 ml-8 p-4 bg-white rounded-lg shadow-sm border-l-4 border-indigo-200">
              <div class="flex items-center mb-2">
                <img class="w-8 h-8 rounded-full" src="{{this.author.profilePicture}}" alt="Profile Picture">
                <p class="ml-3 font-medium">{{this.author.username}}</p>
              </div>
              <p class="text-sm text-gray-500 mb-2">{{formatDate this.createdAt}}</p>
              <p class="text-gray-700">{{{this.content}}}</p>
            </div>
          {{/each}}
        </li>
      {{/each}}
    </ul>
  </section>

  <script src="/javascripts/voting.js"></script>
    <script src="/javascripts/deleteComment.js"></script>
</article>





